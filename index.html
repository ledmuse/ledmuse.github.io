<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LedMuse • Ürün Siteleri Ana Sayfa</title>
  <meta name="description" content="ledmuse.github.io deposundaki 10 ürün web sayfasını bir ana sayfada toplayan bağlantı panosu." />
  <style>
    :root{
      --bg:#0a0f1a; --panel:#0f1729; --muted:#95a4c7; --text:#e9f0fb; --brand:#60a5fa; --accent:#7c3aed; --ring:#1e293b;
      --ok:#22c55e; --warn:#f59e0b; --err:#ef4444; --radius:18px;
    }
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial; color:var(--text);
      background: radial-gradient(1000px 700px at -10% -20%, #162445 0%, transparent 60%),
                  radial-gradient(900px 600px at 120% 0%, #1b2747 0%, transparent 55%),
                  var(--bg);}
    .wrap{max-width:1100px; margin:0 auto; padding:24px}
    header{display:grid; gap:10px; grid-template-columns:1fr auto; align-items:center}
    .brand{font-size: clamp(24px,3.5vw,36px); margin:0}
    .sub{margin:0; color:var(--muted)}
    .badge{font-size:12px; color:#cfe3ff; background:#0e1726; border:1px solid #233454; padding:4px 8px; border-radius:999px}

    .toolbar{display:flex; gap:12px; flex-wrap:wrap; align-items:center; margin:18px 0}
    .input{flex:1 1 240px; min-width:220px; background:var(--panel); color:var(--text); border:1px solid #22314f; border-radius:12px; padding:10px 12px; outline:none}
    .input::placeholder{color:#6f86a7}
    .select,.btn{background:var(--panel); color:var(--text); border:1px solid #22314f; border-radius:12px; padding:10px 12px}
    .btn.primary{background:linear-gradient(180deg,#3b82f6,#1e40af); border:none; color:white; font-weight:600}

    .grid{display:grid; grid-template-columns: repeat( auto-fill, minmax(240px,1fr) ); gap:14px}
    .card{position:relative; background:rgba(17,24,38,.6); border:1px solid #22314f; border-radius:var(--radius); overflow:hidden; transition: transform .2s ease, box-shadow .2s ease}
    .card:hover{transform: translateY(-2px); box-shadow:0 8px 30px rgba(0,0,0,.25)}
    .cover{height:120px; background:linear-gradient(120deg, rgba(96,165,250,.18), rgba(124,58,237,.18)); display:flex; align-items:center; justify-content:center}
    .icon{opacity:.9}
    .body{padding:12px 14px}
    .title{margin:0 0 6px 0; font-size:16px}
    .desc{margin:0; color:var(--muted); font-size:13px; min-height:38px}
    .meta{display:flex; gap:8px; align-items:center; margin-top:10px; font-size:12px; color:#a9bbda}
    .dot{width:8px; height:8px; border-radius:999px; background:var(--ok)}
    .link{position:absolute; inset:0}

    footer{margin-top:20px; color:var(--muted); font-size:12px}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="badge">GitHub Pages • ledmuse.github.io</div>
        <h1 class="brand">Ürün Siteleri Ana Sayfa</h1>
        <p class="sub">Aşağıdaki kartlara tıklayarak her ürünün kendi web sayfasına gidin. Başlık ve açıklamalar sayfa içeriğinden otomatik çekilir.</p>
      </div>
      <button id="refresh" class="btn primary">Yenile</button>
    </header>

    <div class="toolbar">
      <input id="search" class="input" placeholder="Ara: ürün adı / anahtar kelime" />
      <select id="sort" class="select" title="Sırala">
        <option value="name">Ada göre</option>
        <option value="path">Yola göre</option>
      </select>
    </div>

    <div id="grid" class="grid" aria-live="polite"></div>

    <footer>
      Bu ana sayfa, depo kökünde yer alan klasörler içindeki <code>index.html</code> (yoksa ilk <code>.html</code>) dosyasına bağlanır.
      GitHub API sınırı aşıldığında kartlar geçici olarak boş gelebilir; bir süre sonra <em>Yenile</em>’ye basın.
    </footer>
  </div>

  <template id="cardTemplate">
    <article class="card">
      <div class="cover">
        <!-- basit LED simgesi -->
        <svg class="icon" width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 3a6 6 0 0 0-6 6c0 2.22 1.2 4.15 3 5.2V18a3 3 0 0 0 3 3 3 3 0 0 0 3-3v-3.8c1.8-1.05 3-2.98 3-5.2a6 6 0 0 0-6-6Z" stroke="currentColor" stroke-width="1.2"/>
          <path d="M9 11h6M8 14h8" stroke="currentColor" stroke-width="1.2"/>
        </svg>
      </div>
      <div class="body">
        <h3 class="title">Başlık yükleniyor…</h3>
        <p class="desc">Açıklama aranıyor…</p>
        <div class="meta"><span class="dot"></span><span class="path"></span></div>
      </div>
      <a class="link" target="_self" rel="noopener"></a>
    </article>
  </template>

  <script>
    // ==== Yapılandırma ====
    const OWNER = "ledmuse";
    const REPO  = "ledmuse.github.io";

    // Depodaki 10 ürün klasörü (kök dizinde)
    const PROJECTS = [
      { slug: "12-24V-ac-kapat-led-kontrol-unitesi", label: "12–24V AC Kapat LED Kontrol Ünitesi" },
      { slug: "cuppon-bioklimatik-pano",             label: "Cuppon Biyoklimatik Pano" },
      { slug: "cuppon-tilt-pano",                    label: "Cuppon Tilt Pano" },
      { slug: "rgb-led-dimmer",                      label: "RGB LED Dimmer" },
      { slug: "s-bioklimatik-pano",                  label: "S Biyoklimatik Pano" },
      { slug: "s-dimmer",                             label: "S Dimmer" },
      { slug: "s-tilt-bioklimatik-pano",             label: "S Tilt Biyoklimatik Pano" },
      { slug: "sftr-led-dimmer-multi",               label: "SFTR LED Dimmer Multi" },
      { slug: "sftr-led-dimmer",                     label: "SFTR LED Dimmer" },
      { slug: "tilt-piston-motor-kontrol-unitesi",   label: "Tilt Piston Motor Kontrol Ünitesi" },
    ];

    const $ = (s) => document.querySelector(s);
    const grid = $("#grid");

    function makeCard(){
      const node = document.importNode($("#cardTemplate").content, true);
      return node.firstElementChild;
    }

    function setCard(card, {title, desc, href, path}){
      card.querySelector('.title').textContent = title || 'Başlık bulunamadı';
      card.querySelector('.desc').textContent  = desc || 'Başlık/description meta etiketi bulunamadı.';
      card.querySelector('.path').textContent  = path;
      card.querySelector('.link').href = href;
    }

    async function fetchJSON(url){
      const r = await fetch(url, { headers: { 'Accept': 'application/vnd.github.v3+json' } });
      if(!r.ok) throw new Error(await r.text());
      return r.json();
    }

    async function resolveHtmlForFolder(slug){
      // Klasör içeriğini getir ve .html dosyaları arasından index.html'i tercih et
      const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${slug}`;
      const items = await fetchJSON(url);
      const htmls = items.filter(x => x.type === 'file' && /\.html?$/i.test(x.name));
      if(!htmls.length) throw new Error('Klasörde .html dosyası yok');
      const index = htmls.find(x => x.name.toLowerCase() === 'index.html') || htmls[0];
      return index.name; // dosya adı
    }

    async function extractTitleAndDescription(href){
      try{
        const res = await fetch(href, { mode: 'same-origin' });
        const html = await res.text();
        const doc  = new DOMParser().parseFromString(html, 'text/html');
        const title = (doc.querySelector('title')?.textContent || '').trim();
        const desc  = (doc.querySelector('meta[name="description"]')?.getAttribute('content') || doc.querySelector('h1')?.textContent || '').trim();
        return { title, desc };
      }catch(_){
        return { title: '', desc: '' };
      }
    }

    function applySearchAndSort(){
      const q = $("#search").value.trim().toLowerCase();
      const mode = $("#sort").value;
      const cards = Array.from(grid.children);
      for(const el of cards){
        const name = el.dataset.name || '';
        const path = el.dataset.path || '';
        el.style.display = (!q || name.includes(q) || path.includes(q)) ? '' : 'none';
      }
      const visible = cards.filter(c => c.style.display !== 'none');
      visible.sort((a,b)=>{
        if(mode === 'path') return a.dataset.path.localeCompare(b.dataset.path);
        return a.dataset.name.localeCompare(b.dataset.name);
      }).forEach(el => grid.appendChild(el));
    }

    async function bootstrap(){
      grid.innerHTML = '';
      for(const p of PROJECTS){
        const card = makeCard();
        card.dataset.name = p.label.toLowerCase();
        card.dataset.path = p.slug;
        setCard(card, { title: p.label, desc: 'Yükleniyor…', href: '#', path: p.slug });
        grid.appendChild(card);

        try{
          const htmlName = await resolveHtmlForFolder(p.slug);
          const href = `/${p.slug}/${htmlName.toLowerCase() === 'index.html' ? '' : htmlName}`;
          const meta = await extractTitleAndDescription(href);
          setCard(card, {
            title: meta.title || p.label,
            desc: meta.desc || 'Ürün sayfasına gitmek için tıklayın.',
            href, path: p.slug + (htmlName ? `/${htmlName}` : '/')
          });
        }catch(err){
          console.error(p.slug, err);
          card.querySelector('.dot').style.background = 'var(--warn)';
          setCard(card, { title: p.label, desc: 'Bağlantı tespit edilemedi. Klasörde .html var mı?', href: `/${p.slug}/`, path: p.slug + '/' });
        }
      }
      applySearchAndSort();
    }

    $("#refresh").addEventListener('click', bootstrap);
    $("#search").addEventListener('input', applySearchAndSort);
    $("#sort").addEventListener('change', applySearchAndSort);

    bootstrap();
  </script>
</body>
</html>
